
1Arquitectura

De forma a implementar o sistema descrito no enunciado, foi definido um serviço de registo de clientes e um serviço para recepção de mensagens. Foram também criadas duas aplicações consola, uma para ser o servidor que faz hosting do serviço de registo, e outra que faz hosting do serviço de recepção de mensagens.

2Serviços

Para a definição dos contractos dos serviços foi criada uma biblioteca que é partilhada tanto pela aplicação cliente como pelo servidor. Ai definimos o serviço IcentralService e o serviço ICService.

3ICentralService

Este serviço é o serviço principal, hosted por uma aplicação servidora. Este serviço tem associado a ele um contracto de callback,ICService, que está definido e explicado seguidamente.

Neste serviço estão definidas as seguintes operações:

Register(int theme, int language) : int;
UnRegister(int clientId);
GetSupportedLanguages() : string[];
GetSupportedThemes() : string[];
SubmitMessage(string msg).

3ICService

Este serviço, sendo um contracto de callback para IcentralService, define apenas uma operação:

Receive(string msg)

Esta operação está definida como IsOneWay, visto não ser esperado qualquer tipo de feedback após a sua chamada.

2Servidor

A nossa aplicação que faz hosting do serviço IcentralService tém uma implementação desse serviço, onde é definido o comportamento das operações.

Essa implementação foi definida com um modo de concurrência multiplo, dando assim a possibilidade de vários clientes acederem a este serviço concurrentemente. O modo de instanciação é PerCall, e visto os campos que são partilhados pelas instâncias serem campos de tipo não existe a necessidade de definir o modo de instanciação do serviço como singleton.

Para realizar o registo de clientes, utilizámos um repositório estático com uma estrutura de dados concurrente, ConcurrentDictionary, desta forma os acessos feitos por multiplas instâncias do serviço a este repositório estão controladas. No registo de um novo cliente, é guardada a informação de tema e linguagem desse utilizador, é criado um ID unico para ele e guardado uma referência para o serviço de callback associado.

Além da subscrição e revogação de clientes a este servidor, existe também a possibilidade de um cliente fazer um envio de uma mensagem ao servidor que por sua vez irá enviar a todos os clientes interessados. Essa mensagem terá de ser traduzida, utilizando o serviço de tradução do Bing, e enviada a todos os clientes interessados. O envio de mensagens é feito de forma assincrona. 


Para suportar a utilização de um serviço externo foi criada uma WebReference para esse serviço. 

3Tratamento de falhas

No servidor a falhas principal que podemos observar é não existir conexão para com o serviço que estamos a tentar comunicar, essas situações ocorrem na tentativa de envio de mensagem por callback a um cliente, e a chamar o serviço de tradução. Para tal, nesses locais, estamos atento á possibilidade de falha de conexão removendo o cliente do repositório, ou não traduzindo a mensagem, caso os serviços associados estejam offline.
